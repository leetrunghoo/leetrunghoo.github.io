<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flickr rest api example</title>
    <meta name="description" content="Flickr rest api example" />
    <meta name="keywords" content="Flickr, image grid, masonry, demo" />
    <meta name="author" content="Trung Ho" />
    <link rel="shortcut icon" href="{{ site.baseurl }}assets/img/favicon.ico">
    <link rel="stylesheet" type="text/css" href="css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.2.21/css/lightgallery.min.css" />
    <style>
    body {
        padding: 5px;
    }
    
    .grid-item {
        width: calc(33.33% - 10px);
        margin: 5px;
    	-webkit-transition: -webkit-box-shadow .25s;
        transition: box-shadow .25s;
    }
    .grid-item:hover {
        cursor: pointer;
    	-webkit-box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.5), 0 6px 20px 0 rgba(0, 0, 0, 0.6);
  		box-shadow: 0 5px 10px 0 rgba(0, 0, 0, 0.5), 0 6px 20px 0 rgba(0, 0, 0, 0.6);
    }

    </style>
</head>
<body ">
	<div id="container"></div>
	<!-- /container -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.0/imagesloaded.pkgd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.1.0/masonry.pkgd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.2.21/js/lightgallery-all.min.js"></script>
	<script>
		$(function() {
			var apiKey = '986e904143a37c668876552671aacde9',
			  authorId = 'nhienhy',
			  perPage = 10,
			  startPage = 0;

			// Main content container
			var $container = $('#container');

			// Masonry 
			$container.masonry({
		        itemSelector: '.grid-item',
		        columnWidth: '.grid-item',
		        percentPosition: true
			});

			var gallery; 

			function loadImages(page, callback) {
				console.log('loadImages page: '+page);
			  var url = 'https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=' + apiKey + '&user_id=' + authorId + '&per_page=' + perPage + '&page=' + page + '&format=json&nojsoncallback=1';
			  $.getJSON(url, function(response) {
			    if (response.stat === 'ok') {
		      		(function loadEachImg(arrPhotos, index) {
		      			if (index < arrPhotos.length) {
		      				var photo = arrPhotos[index];
		      				var link = 'https://farm' + photo.farm + '.staticflickr.com/' + photo.server + '/' + photo.id + '_' + photo.secret + '.jpg';
					        var $newElem = $('<a href="'+link+'"><img class="grid-item " src=' + link + ' style="display: none"></a>');
					        $container.append($newElem);
							// ensure that new image loaded before adding to masonry layout
							$newElem.imagesLoaded(function(){
								$newElem.show();
								$container.masonry( 'appended', $newElem, true );
								$container.masonry('layout');
								// Init lightGallery
			      				if (gallery) {
			      					gallery.destroy(true);
			      				}
			      				gallery = $container.lightGallery({
								    thumbnail: true,
								    animateThumb: true,
								    showThumbByDefault: false,
								    hash: true
								}).data('lightGallery'); 
								loadEachImg(arrPhotos, ++index);
							});
		      			} else {	// done looping
					      if (callback) {
					        callback();
					      }
		      			}
		      		})(response.photos.photo, 0);
			    }
			  });
			}
			console.log('-----------loadImages');
			loadImages(++startPage, function() {
				// make sure body has scroll therefore be able to do infinitescroll
				if (document.body.scrollHeight <= window.innerHeight) {
					loadImages(++startPage);
				}
			});

			// infinite scroll
			var loadingImages = false;
			$(document).scroll(function() {
			  var docScrollTop = $(document).scrollTop();
			  var endScroll = $(document).height() - $(window).height() - 100;
			  if (!loadingImages && (docScrollTop > endScroll)) {
			    loadingImages = true;
			    loadImages(++startPage, function(){
			      loadingImages = false;
			    });
			  }
			});
		})();
	</script>
</body>

</html>
